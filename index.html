<html>
  <head>
    <meta charset="UTF-8">
    <title>Yelp a Route</title>
      <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0; background-color: #4F4F4F}
        #map-canvas { height: 500px }
        header {}
    </style>
  </head>
  <body>
    <div class="my-content">
    <p>
      <h1>Along the Way</h1>
    </p>
    </div>
    <header>
      <form type="POST" class="search">
        <div class="search-boxes">
          Start: <input id="start" class="search-box" placeholder="Seattle, WA" autofocus required>
          Destination <input id="destination" class="search-box" placeholder="San Francisco, CA"required>
          <button>Search</button>
        <div class="options">
          Food <input type="checkbox" class="food-checkbox" value="food">
          Gas <input type="checkbox"  class="gas-checkbox" value="gas_station">
          Shopping <input type="checkbox" class="shopping-checkbox" value="store">
          Distance:
          <select id="distances">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="5">5</option>
            <option value="10">10</option>
          </select>
        </div>
      </form>
    </header>

    <sidebar id="list-view">
    </sidebar>

    <div id = "map-canvas"></div>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=visualization,places&key=AIzaSyA7tOZNjgHPNh5a-zL1Mo9EFIysbwUU4s4&sensor=false"></script>
    <script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/routeboxer/src/RouteBoxer.js"></script>
    <script src = "polylineToBBox.js"></script>
    <script src = "bboxToPlacesReqArr.js"></script>
    <script src = "calcRoute.js"></script>
    <script src = "executePlacesReqArr.js"></script>
    <script src = "parse_places_array.js"></script>
    <script src = "plot_places.js"></script>
    <script>

    google.maps.event.addDomListener(window,'load',function() {

      var mapOptions = {
           center: new google.maps.LatLng( 39.8,-98.6),
           zoom: 4
      };

      var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
      var searchDistance = 2;
      var searchOptions = {
        type: []
      };

      //adds/removes types from the seach options object when boxes clicked
      $("input[type=checkbox]").on("change", function(){
        var option = $(this).val();
        if($(this).is(":checked")){
          searchOptions.type.push(option);
        } else {
          var index = searchOptions.type.indexOf(option);
          searchOptions.type.splice(index,index+1);
        }
      });

      //empties search box when clicked
      $(".search-box").on("focus", function(){
        $(this).val("");
      });

      //starts route search based on search boxes when submit button clicked
      $(".search").on("submit", function(event){
        //preventDefault stops a new page from loading
        event.preventDefault();
        searchDistance = $("#distances").val();
        console.log("Search from: " + $("#start").val());
        console.log("Search to: "   + $("#destination").val());
        console.log("Distance to search from route " + searchDistance);

        calcRoute($("#start").val(), $("#destination").val(), function(res){
          var bboxArray = polylineToBBox(res.routes[0].overview_path, searchDistance);

          var placesReqArray = bboxToPlacesReqArr(bboxArray, searchOptions, map);

          executePlacesReqArr(placesReqArray, function(results, pagination){

            console.log(results);

          });
        });

      });
    });

    </script>
  </body>
</html>
